@import mason.Project
@(project: Project)

val versions = new {
    val scala = "3.6.3"
    val pillars = "@{project.version.number}"
    val iron = "2.6.0"
    val tapir = "1.11.20"
    val munit = "1.1.0"
    val munitCE = "2.0.0"
}
ThisBuild / organization := "@{project.organizationName}"
ThisBuild / tlBaseVersion := "0.1"
ThisBuild / maintainer := "your.name@@@{project.organizationDomain}"
val Scala3 = "3.6.3"
ThisBuild / scalaVersion := Scala3 // the default Scala

ThisBuild / githubWorkflowOSes         := Seq("ubuntu-latest")
ThisBuild / githubWorkflowJavaVersions := Seq(JavaSpec.graalvm("21"))
ThisBuild / tlCiHeaderCheck          := true
ThisBuild / tlCiScalafmtCheck        := true
ThisBuild / tlCiMimaBinaryIssueCheck := true
ThisBuild / tlCiDependencyGraphJob   := true
ThisBuild / autoAPIMappings          := true

enablePlugins(JavaAppPackaging)
enablePlugins(DockerPlugin)

lazy val root = (project in file("."))
    .enablePlugins(BuildInfoPlugin)
    .settings(
        name := "@{project.name}",
        scalaVersion := Scala3,
        Compile / mainClass := Some("@{project.packageName}.Main"),
        buildInfoKeys                          := Seq[BuildInfoKey](name, version, description),
        buildInfoPackage                       := "@{project.packageName}.build",
        buildInfoUsePackageAsPath := true,
        buildInfoOptions                       := Seq(BuildInfoOption.Traits("pillars.BuildInfo")),
        dockerExposedPorts ++= Seq(9876, 19876),
        libraryDependencies ++=
            Seq(
                "pillars-core",
@for(dep <- project.modules) {
                "pillars-@{dep.name}",
}            ).map("io.funktional" %% _ % versions.pillars),
        libraryDependencies ++= Seq("tapir-core", "tapir-json-circe", "tapir-iron").map("com.softwaremill.sttp.tapir" %% _ % versions.tapir),
        libraryDependencies ++= Seq("iron-circe").map("io.github.iltotore" %% _ % versions.iron),
        libraryDependencies ++= Seq("org.scalameta" %% "munit" % versions.munit % Test),
        libraryDependencies ++= Seq("org.typelevel" %% "munit-cats-effect" % versions.munitCE % Test)
    )
